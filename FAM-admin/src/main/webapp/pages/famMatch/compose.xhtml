<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:p="http://primefaces.org/ui"
        xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<ui:composition
        template="${pageContext.request.servletPath}/common/template.xhtml">

<ui:debug/>

<ui:define name="title">
    <h:outputText value="#{bundle.EditFamMatchTitle}"/>
</ui:define>

<ui:define name="body">
<script type="text/javascript">
    function handleDrop(event, ui) {
        var droppedCar = ui.draggable;

        droppedCar.fadeOut('fast');
    }
</script>

<h:form id="myForm">

    <p:panel
            header="#{famMatchController.selected.famEvent.libEvent}"
            style="height:500px;">
        <p:tabView id="tabsTeam" value="#{famMatchController.lstTeamComposition}" var="tc">
            <p:tab title="#{tc.famTeam.libTeam}">
                <p:tabView id="tabs">
                    <p:tab title="Présélection">

                        <p:fieldset legend="Réponses" toggleable="true">
                            <h:panelGrid columns="2" cellpadding="10">
                                <h:graphicImage name="01_messages.png" library="images/icons"/>

                                <h:panelGrid columns="4">

                                    <p:dataTable id="dtYes"
                                                 value="#{tc.lstYes}"
                                                 var="y"
                                                 paginator="true"
                                                 rows="5"
                                                 pageLinks="1"
                                                 paginatorPosition="bottom"
                                                 paginatorAlwaysVisible="false"
                                                 selection="#{tc.selectedYes}"
                                                 rowKey="#{y.idAnswer}"
                                                 style="height:200px;width:180px;"
                                            >
                                        <p:ajax event="rowSelect" update="@this" partialSubmit="true"/>
                                        <p:ajax event="rowUnselect" update="@this" partialSubmit="true"/>

                                        <p:column selectionMode="multiple"/>

                                        <p:column headerText="Présents (#{fn:length(tc.lstYes)})">
                                            <h:outputText value="#{y.famPlayer.displayName}"/>
                                        </p:column>
                                        <p:column>
                                            <h:outputText id="com"
                                                          value="com"
                                                          title="#{y.comments}"
                                                          rendered="#{not empty y.comments}"/>
                                        </p:column>
                                        <f:facet name="footer">
                                            <p:commandButton value="Add"
                                                             icon="ui-icon ui-icon-search"
                                                             action="#{tc.addSelectedYes}"
                                                             immediate="true"
                                                             disabled="#{empty tc.selectedYes}"
                                                             update="@form"/>
                                        </f:facet>
                                    </p:dataTable>

                                    <p:dataTable value="#{tc.lstMaybe}"
                                                 var="m"
                                                 paginator="true"
                                                 rows="5"
                                                 pageLinks="3"
                                                 paginatorPosition="bottom"
                                                 paginatorAlwaysVisible="false"
                                                 selection="#{tc.selectedMaybe}"
                                                 rowKey="#{m.idAnswer}"
                                                 style="height:200px;width:180px;"
                                            >
                                        <p:ajax event="rowSelect" update="@this" partialSubmit="true"/>
                                        <p:ajax event="rowUnselect" update="@this" partialSubmit="true"/>
                                        <p:column selectionMode="multiple"/>
                                        <p:column
                                                headerText="Ne savent pas (#{fn:length(tc.lstMaybe)})">
                                            <h:outputText value="#{m.famPlayer.displayName}"/>
                                        </p:column>
                                        <p:column>
                                            <h:outputText id="com"
                                                          value="com"
                                                          title="#{m.comments}"
                                                          rendered="#{not empty m.comments}"/>
                                        </p:column>
                                        <f:facet name="footer">
                                            <p:commandButton value="Add"
                                                             icon="ui-icon ui-icon-search"
                                                             action="#{tc.addSelectedMaybe}"
                                                             immediate="true"
                                                             disabled="#{empty tc.selectedMaybe}"
                                                             update="@form"/>
                                        </f:facet>
                                    </p:dataTable>

                                    <p:dataTable value="#{tc.lstNo}"
                                                 var="n"
                                                 paginator="true"
                                                 rows="5"
                                                 pageLinks="3"
                                                 paginatorPosition="bottom"
                                                 paginatorAlwaysVisible="false"
                                                 selection="#{tc.selectedNo}"
                                                 rowKey="#{n.idAnswer}"
                                                 style="height:200px;width:180px;"
                                            >
                                        <p:ajax event="rowSelect" update="@this" partialSubmit="true"/>
                                        <p:ajax event="rowUnselect" update="@this" partialSubmit="true"/>
                                        <p:column selectionMode="multiple"/>
                                        <p:column headerText="Absents (#{fn:length(tc.lstNo)})">
                                            <h:outputText value="#{n.famPlayer.displayName}"/>
                                        </p:column>
                                        <p:column>
                                            <h:outputText id="com"
                                                          value="com"
                                                          title="#{n.comments}"
                                                          rendered="#{not empty n.comments}"/>
                                        </p:column>
                                        <f:facet name="footer">
                                            <p:commandButton value="Add"
                                                             icon="ui-icon ui-icon-search"
                                                             action="#{tc.addSelectedNo}"
                                                             immediate="true"
                                                             disabled="#{empty tc.selectedNo}"
                                                             update="@form"/>
                                        </f:facet>
                                    </p:dataTable>

                                    <p:dataTable value="#{tc.playerDM}"
                                                 var="nsp"
                                                 paginator="true"
                                                 rows="5"
                                                 paginatorPosition="bottom"
                                                 paginatorAlwaysVisible="false"
                                                 pageLinks="1"
                                                 selection="#{tc.selectedPlayers}"
                                                 style="height:200px;width:180px;"
                                            >
                                        <p:ajax event="rowSelect" update="@this" partialSubmit="true"/>
                                        <p:ajax event="rowUnselect" update="@this" partialSubmit="true"/>
                                        <p:column selectionMode="multiple"/>
                                        <p:column
                                                headerText="Sans réponse (#{fn:length(tc.lstPlayer)})">
                                            <h:outputText id="player" value="#{nsp.displayName}"/>
                                            <!--                                            <p:draggable for="player"
                                          revert="true"
                                          handle=".ui-panel-titlebar"
                                          stack=".ui-panel"
                                          />  -->
                                        </p:column>
                                        <f:facet name="footer">
                                            <p:commandButton value="Add"
                                                             icon="ui-icon ui-icon-search"
                                                             immediate="true"
                                                             disabled="#{empty tc.selectedPlayers}"
                                                             update="@form"
                                                             actionListener="#{tc.addSelectedPlayers}"
                                                    />
                                            <!--action="#{famMatchController.addSelectedPlayers}"-->
                                        </f:facet>
                                    </p:dataTable>

                                </h:panelGrid>
                            </h:panelGrid>
                        </p:fieldset>

                        <p:fieldset id="preselection"
                                    legend="Préselection"
                                    style="margin-top:20px">
                            <!--rendered="#{!empty famMatchController.preselectedLst}">-->
                            <!--                            <p:outputPanel id="dropArea" style="height:100px;">  -->

                            <!--                                <h:outputText value="!!!Drop here!!!"
                         rendered="#{empty famMatchController.preselectedLst}"
                         style="font-size:24px;" />  -->
                            <ui:include src="selectedPlayers.xhtml">
                                <ui:param name="list" value="#{tc.preselectedLst}"/>
                                <ui:param name="id" value="preselectedPlayers"/>
                            </ui:include>
                            <!--                            </p:outputPanel>-->
                        </p:fieldset>
                        <!--                        <p:droppable for="preselection" tolerance="touch"
                                    datasource="ds"
                                    activeStyleClass="ui-state-highlight"
                                    onDrop="handleDrop"
                                    >
                           <p:ajax listener="#{famMatchController.onPreselectDrop}" update="@form" />
                       </p:droppable> -->

                    </p:tab>


                    <p:tab title="Sélection" id="tab2">
                        <!--                    <h:form>-->

                        <ui:include src="sub.xhtml"/><!--
                            <ui:param name="list" value="#{famMatchController.preselectedLst}" />
                            <ui:param name="preselection" value="#{true}" />
                            <ui:param name="actionDelete" value="#{famMatchController.deselect}" />
                            <ui:param name="id" value="lstPreselected" />
                        </ui:include>-->
                        <!--                    </h:form>    -->
                    </p:tab>
                </p:tabView>
            </p:tab>
        </p:tabView>

    </p:panel>
</h:form>
</ui:define>

</ui:composition>
</html>
