<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:fn="http://java.sun.com/jsp/jstl/functions"
        xmlns:p="http://primefaces.org/ui"
        >
<ui:composition>

    <p:tab id="tabCompo" title="Composition">
        <script type="text/javascript">
            function handleDrop(event, ui) {
                var droppedCar = ui.draggable;

                droppedCar.fadeOut('fast');
            }
        </script>
        <h:form id="frmCompo">
            <!--@elvariable id="tc" type="org.fam.jsf.bean.TeamComposition"-->
            <h:panelGrid columns="5"
                         cellpadding="10"
                         columnClasses="verticalTop,verticalTop,verticalTop,verticalTop,verticalTop"
                         id="grd6">
                <!--Formation-->
                <h:panelGrid columns="3">
                    <p:outputLabel value="Formation" for="formation"/>
                    <p:selectOneListbox id="formation"
                                        value="#{famMatchController.teamComposition.famMatchTeam.famFormation}"
                                        converter="formationConverter"
                                        style="width:200px;">
                        <!--<f:selectItem itemLabel="Formation" itemValue=""/>-->
                        <!--                                        noSelectionOption="true"/>-->
                        <f:selectItems value="#{cacheBean.listFormation}"
                                       var="f"
                                       itemLabel="#{f.libFormation}"
                                       itemValue="#{f}"/>
                        <!--                    <p:ajax event="blur" update="@form"/>-->
                        <!--                                        listener="#{famMatchController.changeFormation}"/>-->
                        <p:ajax event="valueChange" listener="#{famMatchController.teamComposition.genTarget}"
                                update="dgField"
                                partialSubmit="true"/>
                    </p:selectOneListbox>
                    <p:message id="msg_formation" for="formation"/>
                </h:panelGrid>

                <!--Joueurs disponibles-->
                <!--@elvariable id="item" type="org.fam.ejb.model.FamPlayer"-->
                <p:dataTable id="dtbPreSelected"
                             binding="#{famMatchController.userListComponent}"
                             styleClass="T_#{famMatchController.teamComposition.famTeam.idTeam}"
                             value="#{famMatchController.teamComposition.preselectedLst}"
                             var="item"
                             selectionMode="single"
                             emptyMessage="#{bundle.NoDataFound}"
                             rowKey="#{item.idPlayer}"

                        >
                    <p:column sortBy="#{item.displayName}"
                              headerText="Joueur (#{fn:length(famMatchController.teamComposition.preselectedLst)})">
                        <h:outputText value="#{item.displayName}"/>
                    </p:column>

                    <p:column style="width:24px">
                        <h:outputText id="dragIcon"
                                      styleClass="ui-icon ui-icon-arrow-4"/>
                        <p:draggable for="dragIcon" revert="true" helper="clone"/>
                    </p:column>
                </p:dataTable>

                <!--Lineup-->
                <p:dataGrid id="dgField"
                            value="#{famMatchController.teamComposition.lstTarget}"
                            var="t" columns="5"
                            styleClass="soccer_field"
                        >
                    <!--style="padding-top: 50px;margin-left: 40px;"-->
                    <p:column>
                        <p:panel id="trg"
                                 style="width:50px;height:63px;opacity:0.5;"
                                 rendered="#{!empty t.famFormationItem.numItem}"
                                >
                            <h:outputText value="#{t.famFormationItem.numItem}"
                                          style="text-align:center;font-weight: bolder;"/>
                            <br/>
                            <h:outputText value="#{empty t.famPlayer ? t.famPlayer.displayName : bundle.Empty}"
                                          style="text-align:center;font-weight: bolder;"/>
                            <!--rendered="#{not empty t.famPlayer}"/>-->

                            <p:droppable tolerance="touch"
                                         activeStyleClass="ui-state-highlight"
                                         datasource=":#{famMatchController.userListComponent.clientId}"
                                         onDrop="handleDrop"
                                    >
                                <f:attribute name="num" value="#{t.famFormationItem.numItem}"/>
                                <p:ajax listener="#{famMatchController.onDrop}"
                                        update="dgField :#{famMatchController.selectedComponent.clientId} :#{famMatchController.userListComponent.clientId}"
                                        />
                            </p:droppable>
                        </p:panel>

                    </p:column>
                </p:dataGrid>
                <!--Eo Lineup-->

                <!--Substitutes-->
                <h:panelGroup>
                    <h:graphicImage id="imgSub" name="soccer_2_128.png" library="images/dock"/>
                    <p:dataGrid id="dgSubs"
                                value="#{famMatchController.lstSubs}"
                                var="sub"
                                columns="2"
                                style="padding-top: 25px;margin-left: 20px;">
                        <p:column>
                            <p:panel id="sub"
                                     style="width:50px;height:63px;opacity:0.5;margin-left: 5px;"
                                    >
                                <h:outputText value="#{sub.strIdx}"
                                              style="text-align:center;font-weight: bolder;"/>
                                <br/>
                                <h:outputText value="#{sub.famPlayer.displayName}"
                                              style="text-align:center;font-weight: bolder;"
                                              rendered="#{not empty sub.famPlayer}"/>

                                <p:droppable tolerance="touch"
                                             activeStyleClass="ui-state-highlight"
                                             onDrop="handleDrop"
                                             datasource=":#{famMatchController.userListComponent.clientId}"
                                        >
                                    <!--<f:attribute name="num" value="#{sub.strIdx}"/>-->
                                    <p:ajax listener="#{famMatchController.onSubDrop}"
                                            update="dgSubs :#{famMatchController.selectedComponent.clientId} @(dtbPreSelected)"

                                            />
                                </p:droppable>
                            </p:panel>


                        </p:column>

                    </p:dataGrid>
                </h:panelGroup>
                <!--Eo Substitutes-->

                <!--Lineup final-->
                <!--@elvariable id="mp" type="org.fam.ejb.model.FamMatchPlayer"-->
                <p:dataTable id="dtbSelected"
                             binding="#{famMatchController.selectedComponent}"
                             value="#{famMatchController.famMatchPlayerList}"
                             var="mp"
                             emptyMessage="#{bundle.NoDataFound}"
                             rowKey="#{mp.num}"
                             rowStyleClass="#{mp.num gt famMatchController.selected.famSeasonCompetition.famTypCompetition.famTypMatch.nbPlayer ? 'row-sub' : null}">
                    <p:column headerText="Poste">
                        <h:outputText value="#{mp.num}"/>
                    </p:column>
                    <p:column headerText="Joueur">
                        <h:outputText value="#{mp.famPlayer.displayName}"/>
                    </p:column>
                </p:dataTable>
                <!--Eo Lineup final-->

            </h:panelGrid>
            <p:blockUI block="frmCompo" trigger="saveBtn">
                SAVING<br/>
                <h:graphicImage library="images" name="ajax-loader1.gif"
                                style="margin-right: 12px; vertical-align: middle;"/>
            </p:blockUI>
            <p:commandButton id="saveBtn"
                             value="Enregistrer"
                             action="#{famMatchController.saveLineup}"
                    />
        </h:form>
    </p:tab>

</ui:composition>
</html>
